<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Telematik</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;line-height:1.45;margin:1.5rem;background:#f7f7fb;color:#1b1b1f}
    h1{font-size:1.4rem;margin-bottom:.8rem}
    .layout{display:grid;grid-template-columns:220px 1fr;gap:1rem}
    .sidebar{background:white;border:1px solid #e6e6ef;border-radius:10px;padding:.75rem;height:calc(100vh - 3rem);position:sticky;top:1.5rem}
    .nav-title{font-size:.9rem;color:#666;margin:0 0 .5rem}
    .nav{display:flex;flex-direction:column;gap:.25rem}
    .nav a{display:block;text-decoration:none;color:#1b1b1f;padding:.5rem .6rem;border-radius:8px;border:1px solid transparent;font-size:.95rem}
    .nav a:hover{background:#f3f6ff;border-color:#e1e7ff}
    .nav a.is-active{background:#f0f6ff;border-color:#cfe1ff;color:#0b63c7;box-shadow:0 0 0 2px rgba(59,130,246,.1) inset}
    .content{min-width:0}
    .grid-1col{display:grid;gap:.75rem;grid-template-columns:minmax(260px, 720px)}
    .card{background:white;border:1px solid #e6e6ef;border-radius:10px;padding:.75rem;transition:border-color .15s ease, box-shadow .15s ease, background-color .15s ease}
    .card h2{font-size:1rem;margin:0 0 .4rem}
    .card:hover{border-color:#cfd8ff}
    .card:focus-within,
    .card.is-active{border-color:#93c5fd;box-shadow:0 0 0 3px rgba(59,130,246,.15);background:#f8fbff}
    form{display:flex;flex-direction:column;gap:.4rem}
    input[type=file], input[type=text]{padding:.4rem;border:1px solid #cfcfe6;border-radius:7px}
    button{background:#3b82f6;color:white;border:none;padding:.5rem .8rem;border-radius:7px;cursor:pointer;font-size:.9rem}
    button:hover{background:#2563eb}
    .suggest{margin-top:.4rem}
    .suggest code{cursor:pointer; user-select:all}
    .suggest code[data-copied="1"]::after{content:" kopiert"; color:#16a34a; font-weight:600; margin-left:.25rem}
    .suggest .copy-suggest{margin-left:.5rem; padding:.25rem .5rem; font-size:.8rem; background:#10b981}
    .suggest .copy-suggest[disabled]{opacity:.55; cursor:not-allowed}
    footer{margin-top:2rem;color:#666;font-size:.9rem}
    code{background:#f0f0f6;padding:.1rem .3rem;border-radius:4px}
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="nav-title">Menü</div>
      <nav class="nav">
        <a href="/transaktion">Transaktion</a>
        <a href="/mention">Mention</a>
        <a href="/telematik" class="is-active">Telematik</a>
        <a href="/rentenbefreiung">Rentenbefreiung</a>
        <a href="/logout">Ausloggen</a>
      </nav>
    </aside>
    <main class="content">
      <section aria-labelledby="telematik-title">
        <h1 id="telematik-title">Telematik (Apetito)</h1>
        <div class="grid-1col">
          <div class="card">
            <h2>Excel verarbeiten (.xlsx)</h2>
            <form action="/telematik/process" method="post" enctype="multipart/form-data">
              <label>Excel (.xlsx) <input type="file" name="file" accept=".xlsx" required></label>
              <button type="submit">Verarbeiten & Herunterladen (Excel)</button>
            </form>
            <p class="suggest">Speicherort (Server): <code class="suggest-target"></code><button type="button" class="copy-suggest" disabled>Kopieren</button></p>
            <p style="color:#555;font-size:.9rem">Hinweis: Die Datei wird zusätzlich auf dem Server unter O:\apetito\apetitotelematik\YYYYMMDD.xlsx gespeichert.</p>
          </div>
        </div>
      </section>
      <footer>
        <p>Im Windows „Speichern unter“-Dialog: <strong>Strg+V</strong> und danach <strong>Enter</strong>, um direkt zum kopierten Ordner zu wechseln.</p>
      </footer>
    </main>
  </div>
  <script>
    (function(){
      function setActiveCard(cardEl){
        document.querySelectorAll('.card').forEach(function(c){ c.classList.remove('is-active'); });
        if (cardEl) cardEl.classList.add('is-active');
      }
      function todaySlug(){
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth()+1).padStart(2,'0');
        const day = String(d.getDate()).padStart(2,'0');
        return `${y}${m}${day}`;
      }
      function serverPath(){
        const SEP='\\';
        return `O:${SEP}apetito${SEP}apetitotelematik${SEP}${todaySlug()}.xlsx`;
      }
      const card = document.querySelector('.card');
      const target = document.querySelector('.suggest-target');
      const btn = document.querySelector('.copy-suggest');
      if (target){
        target.textContent = serverPath();
      }
      function copyText(text, targetEl){
        if (!text) return;
        const done = () => {
          if (targetEl){
            targetEl.setAttribute('data-copied','1');
            setTimeout(()=>targetEl.removeAttribute('data-copied'), 1200);
          }
        };
        if (navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(text).then(done).catch(()=>fallback());
        } else {
          fallback();
        }
        function fallback(){
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); } catch(e) {}
          document.body.removeChild(ta);
          done();
        }
      }
      if (btn){
        btn.disabled = false;
        btn.addEventListener('click', function(){
          const text = target ? (target.textContent || '') : '';
          if (text.trim()) copyText(text, target);
        });
      }
      if (target){
        target.title = 'Klicken zum Kopieren';
        target.addEventListener('click', function(){
          const text = target.textContent || '';
          if (text.trim()) copyText(text, target);
        });
      }
      if (card){
        card.addEventListener('click', function(){ setActiveCard(card); });
        const form = card.querySelector('form');
        if (form){
          form.addEventListener('focusin', function(){ setActiveCard(card); });
        }
      }
    })();
  </script>
</body>
</html>


